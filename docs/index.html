<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análise Interativa: Hábitos Estudantis e Desempenho Acadêmico</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/chartjs-chart-boxplot@4.2.5/build/index.umd.min.js"></script>
    <!-- Visualization & Content Choices:
        - Overview: Text (intro), dynamic stats (count, avg score), Chart.js bar chart (exam_score distribution, calculated bins). Goal: Inform.
        - AED: HTML/CSS table for correlation matrix (numeric features), Chart.js bar charts (selectable predictors, numeric ones with calculated bins). Goal: Explore relationships, distributions.
        - Study Habits: Chart.js scatter (study_hours vs score, attendance vs score), Chart.js boxplot (score by study_hour_bins). Goal: Deep dive, compare.
        - Lifestyle: Interactive selectors (dropdown/buttons) to pick a factor. Numeric factors -> Chart.js scatter vs score. Categorical factors -> Chart.js boxplot of score by category. Goal: Explore specific impacts, compare.
        - Predictive: Text (model summary), Chart.js horizontal bar (feature importance). Goal: Inform about model insights.
        - Conclusions: Text (summary, limitations). Goal: Inform.
        All charts are Canvas-based via Chart.js. Interactions include tab navigation, dropdowns for chart selection, tooltips on charts. Justification: Standard, clear visualizations for common data types, promoting understanding. NO SVG/Mermaid. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px; /* Adjusted for better viewing */
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px; /* Consistent max height */
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
                max-height: 450px;
            }
        }
        .tab-button {
            transition: all 0.3s ease;
        }
        .tab-button.active {
            border-color: #0D9488; /* Teal-600 */
            color: #0D9488;
            font-weight: 600;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; /* slate-300 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; /* slate-500 */
        }
    </style>
</head>
<body class="bg-orange-50 text-slate-700">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-teal-700">Análise Interativa de Hábitos Estudantis e Desempenho Acadêmico</h1>
            <p class="text-slate-600 mt-2">Explorando o dataset "Student Habits vs Academic Performance" do Kaggle.</p>
        </header>

        <nav class="mb-8 flex flex-wrap justify-center gap-2 md:gap-4">
            <button data-tab="overview" class="tab-button active text-sm md:text-base px-4 py-2 border-b-2 border-transparent hover:border-teal-500 hover:text-teal-600 rounded-t-md">Visão Geral</button>
            <button data-tab="aed" class="tab-button text-sm md:text-base px-4 py-2 border-b-2 border-transparent hover:border-teal-500 hover:text-teal-600 rounded-t-md">Exploração Geral (AED)</button>
            <button data-tab="study_habits" class="tab-button text-sm md:text-base px-4 py-2 border-b-2 border-transparent hover:border-teal-500 hover:text-teal-600 rounded-t-md">Hábitos de Estudo</button>
            <button data-tab="lifestyle" class="tab-button text-sm md:text-base px-4 py-2 border-b-2 border-transparent hover:border-teal-500 hover:text-teal-600 rounded-t-md">Estilo de Vida</button>
            <button data-tab="predictive" class="tab-button text-sm md:text-base px-4 py-2 border-b-2 border-transparent hover:border-teal-500 hover:text-teal-600 rounded-t-md">Análise Preditiva</button>
            <button data-tab="conclusions" class="tab-button text-sm md:text-base px-4 py-2 border-b-2 border-transparent hover:border-teal-500 hover:text-teal-600 rounded-t-md">Conclusões</button>
        </nav>

        <main>
            <section id="overview" class="tab-content bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-semibold text-teal-600 mb-4">0. Introdução e Objetivos do Projeto</h2>
                <p class="mb-4">Este projeto apresenta uma análise da relação entre os hábitos de vida dos estudantes e seu desempenho acadêmico, utilizando o dataset sintético "Student Habits vs Academic Performance" do Kaggle. O objetivo é demonstrar um fluxo de trabalho em ciência de dados, desde a limpeza e exploração até a modelagem básica, com foco na criação de um portfólio robusto.</p>
                <p class="mb-4">É crucial notar que o dataset é composto por 1.000 registros de estudantes simulados. As conclusões são para demonstrar técnicas de ciência de dados e não devem ser generalizadas para populações reais sem validação com dados autênticos.</p>
                
                <h3 class="text-xl font-semibold text-teal-600 mt-6 mb-3">Estatísticas Chave do Dataset</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-orange-100 p-4 rounded-lg shadow text-center">
                        <p class="text-3xl font-bold text-teal-700">1000</p>
                        <p class="text-slate-600">Registros de Estudantes</p>
                    </div>
                    <div class="bg-orange-100 p-4 rounded-lg shadow text-center">
                        <p class="text-3xl font-bold text-teal-700">16</p>
                        <p class="text-slate-600">Variáveis Analisadas</p>
                    </div>
                    <div class="bg-orange-100 p-4 rounded-lg shadow text-center">
                        <p class="text-3xl font-bold text-teal-700" id="avgExamScore">72.5</p>
                        <p class="text-slate-600">Média (Simulada) de Notas</p>
                    </div>
                </div>

                <h3 class="text-xl font-semibold text-teal-600 mt-6 mb-3">Distribuição das Notas dos Exames (`exam_score`)</h3>
                <p class="mb-4">A variável alvo, `exam_score`, representa a pontuação final no exame. Sua distribuição nos dá uma ideia do desempenho geral dos estudantes (simulados) no dataset.</p>
                <div class="chart-container mx-auto">
                    <canvas id="examScoreDistributionChart"></canvas>
                </div>
                 <p class="text-sm text-slate-500 mt-2 text-center">Este histograma mostra a frequência de diferentes faixas de notas.</p>
            </section>

            <section id="aed" class="tab-content hidden bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-semibold text-teal-600 mb-4">3. Análise Exploratória de Dados (AED) Geral</h2>
                <p class="mb-4">Nesta seção, exploramos as características gerais do dataset, incluindo a distribuição das variáveis preditoras e suas correlações com a nota do exame.</p>

                <h3 class="text-xl font-semibold text-teal-600 mt-6 mb-3">Matriz de Correlação (Valores Simulados)</h3>
                <p class="mb-4">A tabela abaixo mostra correlações (simuladas) de Pearson entre variáveis numéricas selecionadas e a nota do exame. Valores próximos de +1 ou -1 indicam uma forte relação linear.</p>
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white border border-slate-200 rounded-lg shadow mb-6">
                        <thead class="bg-orange-100">
                            <tr>
                                <th class="py-2 px-4 border-b text-slate-700 text-left">Variável</th>
                                <th class="py-2 px-4 border-b text-slate-700 text-left">Correlação com `exam_score`</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td class="py-2 px-4 border-b">Idade (`age`)</td><td class="py-2 px-4 border-b">0.05</td></tr>
                            <tr><td class="py-2 px-4 border-b">Horas de Estudo/Dia (`study_hours_per_day`)</td><td class="py-2 px-4 border-b">0.85</td></tr>
                            <tr><td class="py-2 px-4 border-b">Horas em Mídias Sociais (`social_media_hours`)</td><td class="py-2 px-4 border-b">-0.40</td></tr>
                            <tr><td class="py-2 px-4 border-b">Horas em Netflix (`netflix_hours`)</td><td class="py-2 px-4 border-b">-0.35</td></tr>
                            <tr><td class="py-2 px-4 border-b">Frequência nas Aulas (`attendance_percentage`)</td><td class="py-2 px-4 border-b">0.70</td></tr>
                            <tr><td class="py-2 px-4 border-b">Horas de Sono (`sleep_hours`)</td><td class="py-2 px-4 border-b">0.55</td></tr>
                            <tr><td class="py-2 px-4 border-b">Frequência de Exercícios (`exercise_frequency`)</td><td class="py-2 px-4 border-b">0.25</td></tr>
                            <tr><td class="py-2 px-4 border-b">Saúde Mental (`mental_health_rating`)</td><td class="py-2 px-4 border-b">0.65</td></tr>
                        </tbody>
                    </table>
                </div>
                
                <h3 class="text-xl font-semibold text-teal-600 mt-6 mb-3">Distribuição de Variáveis Preditivas</h3>
                <p class="mb-4">Selecione uma variável para visualizar sua distribuição:</p>
                <select id="predictorSelector" class="mb-4 p-2 border border-slate-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
                    <option value="study_hours_per_day">Horas de Estudo/Dia</option>
                    <option value="social_media_hours">Horas em Mídias Sociais</option>
                    <option value="sleep_hours">Horas de Sono</option>
                    <option value="gender">Gênero</option>
                    <option value="diet_quality">Qualidade da Dieta</option>
                </select>
                <div class="chart-container mx-auto">
                    <canvas id="predictorDistributionChart"></canvas>
                </div>
                 <p class="text-sm text-slate-500 mt-2 text-center">Histograma para variáveis numéricas, gráfico de barras para categóricas.</p>
            </section>

            <section id="study_habits" class="tab-content hidden bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-semibold text-teal-600 mb-4">4. Análise: Hábitos de Estudo vs. Desempenho</h2>
                <p class="mb-4">Esta seção foca em como hábitos de estudo específicos, como horas dedicadas ao estudo e frequência às aulas, se relacionam com as notas dos exames.</p>

                <h3 class="text-xl font-semibold text-teal-600 mt-6 mb-3">Horas de Estudo/Dia vs. Nota do Exame</h3>
                <div class="chart-container mx-auto mb-4">
                    <canvas id="studyHoursVsScoreChart"></canvas>
                </div>
                <p class="text-sm text-slate-500 mt-[-10px] mb-6 text-center">Gráfico de dispersão mostrando a relação entre horas de estudo e nota.</p>

                <h3 class="text-xl font-semibold text-teal-600 mt-6 mb-3">Frequência às Aulas vs. Nota do Exame</h3>
                 <div class="chart-container mx-auto mb-4">
                    <canvas id="attendanceVsScoreChart"></canvas>
                </div>
                <p class="text-sm text-slate-500 mt-[-10px] mb-6 text-center">Gráfico de dispersão mostrando a relação entre frequência e nota.</p>
                
                <h3 class="text-xl font-semibold text-teal-600 mt-6 mb-3">Desempenho por Faixas de Horas de Estudo</h3>
                 <div class="chart-container mx-auto mb-4">
                    <canvas id="studyHoursBinsChart"></canvas>
                </div>
                <p class="text-sm text-slate-500 mt-[-10px] mb-6 text-center">Boxplot comparando notas para diferentes faixas de horas de estudo.</p>
            </section>

            <section id="lifestyle" class="tab-content hidden bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-semibold text-teal-600 mb-4">5. Análise: Estilo de Vida e Bem-Estar vs. Desempenho</h2>
                <p class="mb-4">Aqui, exploramos como fatores de estilo de vida (sono, dieta, saúde mental, etc.) e contexto socioeconômico (simulado) se associam ao desempenho acadêmico.</p>
                <p class="mb-4">Selecione um fator para visualizar sua relação com a nota do exame:</p>
                <select id="lifestyleFactorSelector" class="mb-4 p-2 border border-slate-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
                    <option value="sleep_hours">Horas de Sono</option>
                    <option value="mental_health_rating">Saúde Mental (Escala 1-10)</option>
                    <option value="diet_quality">Qualidade da Dieta</option>
                    <option value="parental_education_level">Nível Educacional dos Pais</option>
                    <option value="extracurricular_participation">Participação Extracurricular</option>
                    <option value="part_time_job">Trabalho em Meio Período</option>
                </select>
                <div class="chart-container mx-auto">
                    <canvas id="lifestyleFactorChart"></canvas>
                </div>
                <p id="lifestyleChartDescription" class="text-sm text-slate-500 mt-2 text-center">Gráfico de dispersão para numéricos, boxplot para categóricos.</p>
            </section>

            <section id="predictive" class="tab-content hidden bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-semibold text-teal-600 mb-4">6. Análise Preditiva Simplificada: Previsão de Notas</h2>
                <p class="mb-4">Nesta seção, demonstramos um processo simplificado de machine learning para prever a nota do exame. O objetivo é ilustrar a aplicação de técnicas como seleção de features, treinamento de modelo e avaliação, usando dados simulados.</p>
                
                <h3 class="text-xl font-semibold text-teal-600 mt-6 mb-3">Performance (Simulada) dos Modelos</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white border border-slate-200 rounded-lg shadow mb-6">
                        <thead class="bg-orange-100">
                            <tr>
                                <th class="py-2 px-4 border-b text-slate-700 text-left">Modelo</th>
                                <th class="py-2 px-4 border-b text-slate-700 text-left">RMSE (no teste)</th>
                                <th class="py-2 px-4 border-b text-slate-700 text-left">R² (no teste)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td class="py-2 px-4 border-b">Regressão Linear</td><td class="py-2 px-4 border-b">8.52</td><td class="py-2 px-4 border-b">0.78</td></tr>
                            <tr><td class="py-2 px-4 border-b">Random Forest Regressor</td><td class="py-2 px-4 border-b">6.95</td><td class="py-2 px-4 border-b">0.85</td></tr>
                        </tbody>
                    </table>
                </div>
                <p class="text-sm text-slate-500 mb-4">RMSE (Raiz do Erro Quadrático Médio) indica o erro médio das previsões. R² (R-quadrado) indica a proporção da variância da nota que o modelo consegue explicar. Valores simulados para ilustração.</p>

                <h3 class="text-xl font-semibold text-teal-600 mt-6 mb-3">Importância das Features (Exemplo do Random Forest)</h3>
                <p class="mb-4">O gráfico abaixo mostra quais características (features) o modelo Random Forest (simulado) considerou mais importantes para prever a nota do exame.</p>
                <div class="chart-container mx-auto" style="height: 400px; max-height: 500px;">
                    <canvas id="featureImportanceChart"></canvas>
                </div>
            </section>

            <section id="conclusions" class="tab-content hidden bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-semibold text-teal-600 mb-4">7. Principais Descobertas, Conclusões e Próximos Passos</h2>
                <p class="mb-4">Esta análise do dataset sintético "Student Habits vs Academic Performance" permitiu aplicar diversas técnicas de ciência de dados. As descobertas (simuladas) sugerem que hábitos de estudo, bem-estar e saúde mental estão associados ao desempenho acadêmico.</p>
                
                <h3 class="text-xl font-semibold text-teal-600 mt-6 mb-3">Sumário das Descobertas (Simuladas)</h3>
                <ul class="list-disc list-inside mb-4 space-y-1">
                    <li><strong>Hábitos de Estudo:</strong> Horas de estudo e frequência às aulas mostraram forte correlação positiva com as notas.</li>
                    <li><strong>Estilo de Vida:</strong> Uso excessivo de mídias sociais tendeu a correlacionar-se negativamente. Sono adequado e boa saúde mental mostraram associação positiva com o desempenho.</li>
                    <li><strong>Modelagem:</strong> Modelos como Random Forest indicaram que `study_hours_per_day`, `attendance_percentage` e `mental_health_rating` são preditores importantes.</li>
                </ul>

                <h3 class="text-xl font-semibold text-teal-600 mt-6 mb-3">Limitações</h3>
                <ul class="list-disc list-inside mb-4 space-y-1">
                    <li><strong>Natureza Sintética dos Dados:</strong> As conclusões são específicas para este dataset simulado e servem para fins de demonstração metodológica.</li>
                    <li><strong>Tamanho do Dataset:</strong> 1000 observações podem limitar a complexidade dos modelos e a robustez estatística para subgrupos.</li>
                </ul>

                <h3 class="text-xl font-semibold text-teal-600 mt-6 mb-3">Próximos Passos Sugeridos</h3>
                 <ul class="list-disc list-inside mb-4 space-y-1">
                    <li>Validação com dados reais de estudantes (respeitando ética e privacidade).</li>
                    <li>Exploração de modelos preditivos mais avançados.</li>
                    <li>Engenharia de features mais aprofundada.</li>
                </ul>
                <p>Este projeto serve como uma demonstração das capacidades analíticas e de comunicação de resultados em um contexto de ciência de dados.</p>
            </section>
        </main>

        <footer class="text-center mt-12 py-6 border-t border-slate-200">
            <p class="text-slate-500 text-sm">Projeto de Portfólio Interativo - Desenvolvido com base no relatório fornecido.</p>
            <div class="mt-2">
                <a href="https://github.com/alex-des-santos/portifolio" target="_blank" rel="noopener noreferrer" class="text-teal-600 hover:text-teal-700 hover:underline text-sm mx-2">Repositório GitHub</a>
                <span class="text-slate-400">|</span>
                <a href="https://www.linkedin.com/in/alexxsalles/" target="_blank" rel="noopener noreferrer" class="text-teal-600 hover:text-teal-700 hover:underline text-sm mx-2">Perfil LinkedIn</a>
            </div>
        </footer>
    </div>

    <script>
        // Chart.js Global Configuration
        Chart.defaults.font.family = 'Inter, sans-serif';
        Chart.defaults.color = '#475569'; // slate-600

        // Sample Data (simulated based on report descriptions)
        const studentData = {
            exam_scores: Array.from({length: 1000}, () => 40 + Math.random() * 60).map(s => parseFloat(s.toFixed(1))), // Simulating 1000 scores
            study_hours: Array.from({length: 100}, (_,i) => ({ x: (Math.random() * 7 + 1).toFixed(1), y: (50 + Math.random() * 40 + i*0.1).toFixed(1) })),
            attendance: Array.from({length: 100}, (_,i) => ({ x: (60 + Math.random() * 40).toFixed(1), y: (45 + Math.random() * 45 + i*0.1).toFixed(1) })),
            sleep_hours_data: Array.from({length: 100}, (_,i) => ({ x: (4 + Math.random() * 5).toFixed(1), y: (50 + Math.random() * 35 + i*0.05).toFixed(1) })),
            mental_health_data: Array.from({length: 100}, (_,i) => ({ x: (1 + Math.random() * 9).toFixed(0), y: (40 + Math.random() * 50 + i*0.1).toFixed(1) })),
            social_media_hours: Array.from({length: 200}, () => parseFloat((Math.random() * 5).toFixed(1))), // for distribution
        };
        
        document.getElementById('avgExamScore').textContent = (studentData.exam_scores.reduce((a, b) => a + b, 0) / studentData.exam_scores.length).toFixed(1);

        // Chart instances
        let examScoreChart, predictorChart, studyHoursChart, attendanceChart, studyBinsChart, lifestyleChart, featureImportanceChart;

        // Utility to destroy chart if exists
        function destroyChart(chartInstance) {
            if (chartInstance) {
                chartInstance.destroy();
            }
        }

        // Function to calculate histogram bins and labels
        function calculateHistogramData(values, numBinsOption) {
            const numericValues = values.filter(v => typeof v === 'number' && !isNaN(v));
            if (!numericValues || numericValues.length === 0) return { labels: [], data: [] };

            const min = Math.min(...numericValues);
            const max = Math.max(...numericValues);

            if (min === max) { // All values are the same
                return { labels: [min.toFixed(1)], data: [numericValues.length] };
            }

            const numBins = numBinsOption || Math.ceil(Math.sqrt(numericValues.length));
            const binWidth = (max - min) / numBins;

            const bins = new Array(numBins).fill(0);
            const labels = new Array(numBins);

            for (let i = 0; i < numBins; i++) {
                const binStart = min + i * binWidth;
                const binEnd = min + (i + 1) * binWidth;
                labels[i] = `${binStart.toFixed(1)}-${binEnd.toFixed(1)}`;
            }

            numericValues.forEach(value => {
                let binIndex = Math.floor((value - min) / binWidth);
                if (value === max) { 
                    binIndex = numBins - 1;
                }
                binIndex = Math.max(0, Math.min(binIndex, numBins - 1));
                bins[binIndex]++;
            });
            return { labels: labels, data: bins };
        }
        
        // Tab navigation
        const tabs = document.querySelectorAll('.tab-button');
        const contents = document.querySelectorAll('.tab-content');

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(item => item.classList.remove('active'));
                tab.classList.add('active');

                const target = tab.getAttribute('data-tab');
                contents.forEach(content => {
                    if (content.id === target) {
                        content.classList.remove('hidden');
                        // Initialize or update charts for the active tab
                        if (target === 'overview') initOverviewCharts();
                        if (target === 'aed') initAedCharts();
                        if (target === 'study_habits') initStudyHabitsCharts();
                        if (target === 'lifestyle') initLifestyleCharts();
                        if (target === 'predictive') initPredictiveCharts();

                    } else {
                        content.classList.add('hidden');
                    }
                });
            });
        });

        // Initial chart setup for the default active tab (Overview)
        function initOverviewCharts() {
            destroyChart(examScoreChart);
            const ctxExamScore = document.getElementById('examScoreDistributionChart').getContext('2d');
            const examScoreHistData = calculateHistogramData(studentData.exam_scores);

            examScoreChart = new Chart(ctxExamScore, {
                type: 'bar', 
                data: {
                    labels: examScoreHistData.labels, 
                    datasets: [{
                        label: 'Distribuição das Notas',
                        data: examScoreHistData.data, 
                        backgroundColor: 'rgba(13, 148, 136, 0.6)', 
                        borderColor: 'rgba(13, 148, 136, 1)', 
                        borderWidth: 1,
                        barPercentage: 0.9,
                        categoryPercentage: 1.0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'Número de Estudantes'} },
                        x: { title: { display: true, text: 'Nota do Exame'} }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Faixa: ${context.label}, Contagem: ${context.parsed.y}`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function initAedCharts() {
            const predictorSelect = document.getElementById('predictorSelector');
            const selectedPredictor = predictorSelect.value;
            plotPredictorDistribution(selectedPredictor); 

            predictorSelect.onchange = () => {
                plotPredictorDistribution(predictorSelect.value);
            };
        }

        function plotPredictorDistribution(predictorKey) {
            destroyChart(predictorChart);
            const ctxPredictor = document.getElementById('predictorDistributionChart').getContext('2d');
            let chartType = 'bar'; 
            let chartData, chartLabels, title;
            let isHistogramBehavior = false; 

            switch(predictorKey) {
                case 'study_hours_per_day':
                    const studyHoursValues = studentData.study_hours.map(d => parseFloat(d.x));
                    const studyHoursHist = calculateHistogramData(studyHoursValues);
                    chartLabels = studyHoursHist.labels;
                    chartData = studyHoursHist.data;
                    title = 'Distribuição de Horas de Estudo/Dia';
                    isHistogramBehavior = true;
                    break;
                case 'social_media_hours':
                    const socialMediaValues = studentData.social_media_hours;
                    const socialMediaHist = calculateHistogramData(socialMediaValues);
                    chartLabels = socialMediaHist.labels;
                    chartData = socialMediaHist.data;
                    title = 'Distribuição de Horas em Mídias Sociais';
                    isHistogramBehavior = true;
                    break;
                case 'sleep_hours':
                    const sleepHoursValues = studentData.sleep_hours_data.map(d => parseFloat(d.x));
                    const sleepHoursHist = calculateHistogramData(sleepHoursValues);
                    chartLabels = sleepHoursHist.labels;
                    chartData = sleepHoursHist.data;
                    title = 'Distribuição de Horas de Sono';
                    isHistogramBehavior = true;
                    break;
                case 'gender':
                    chartLabels = ['Masculino', 'Feminino', 'Outro'];
                    chartData = [480, 490, 30]; 
                    title = 'Distribuição por Gênero';
                    break;
                case 'diet_quality':
                    chartLabels = ['Ruim', 'Razoável', 'Boa'];
                    chartData = [250, 450, 300]; 
                    title = 'Distribuição da Qualidade da Dieta';
                    break;
                default:
                    chartData = []; chartLabels = []; title = '';
            }

            const chartConfig = {
                type: 'bar', 
                data: {
                    labels: chartLabels, 
                    datasets: [{
                        label: title,
                        data: chartData,
                        backgroundColor: 'rgba(13, 148, 136, 0.6)',
                        borderColor: 'rgba(13, 148, 136, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'Contagem' } },
                        x: { title: { display: true, text: predictorKey.replace(/_/g, ' ') } }
                    },
                     plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                     if (isHistogramBehavior) { 
                                        return `Faixa: ${context.label}, Contagem: ${context.parsed.y}`;
                                     }
                                     return `${context.dataset.label}: ${context.parsed.y}`;
                                }
                            }
                        }
                    }
                };
            
            predictorChart = new Chart(ctxPredictor, chartConfig);
        }

        function initStudyHabitsCharts() {
            destroyChart(studyHoursChart);
            const ctxStudyHours = document.getElementById('studyHoursVsScoreChart').getContext('2d');
            studyHoursChart = new Chart(ctxStudyHours, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Horas de Estudo vs. Nota',
                        data: studentData.study_hours.map(d => ({x: parseFloat(d.x), y: parseFloat(d.y)})),
                        backgroundColor: 'rgba(13, 148, 136, 0.6)'
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: { x: { title: { display: true, text: 'Horas de Estudo/Dia'}}, y: { title: { display: true, text: 'Nota do Exame'}}}
                }
            });

            destroyChart(attendanceChart);
            const ctxAttendance = document.getElementById('attendanceVsScoreChart').getContext('2d');
            attendanceChart = new Chart(ctxAttendance, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Frequência (%) vs. Nota',
                        data: studentData.attendance.map(d => ({x: parseFloat(d.x), y: parseFloat(d.y)})),
                        backgroundColor: 'rgba(13, 148, 136, 0.6)'
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: { x: { title: { display: true, text: 'Frequência às Aulas (%)'}}, y: { title: { display: true, text: 'Nota do Exame'}}}
                }
            });
            
            destroyChart(studyBinsChart);
            const ctxStudyBins = document.getElementById('studyHoursBinsChart').getContext('2d');
            studyBinsChart = new Chart(ctxStudyBins, {
                type: 'boxplot',
                data: {
                    labels: ['0-2h', '2.1-4h', '4.1-6h', '>6h'],
                    datasets: [{
                        label: 'Notas por Faixa de Horas de Estudo',
                        data: [
                            studentData.exam_scores.filter((s,i) => { const sh = parseFloat(studentData.study_hours[i % studentData.study_hours.length]?.x); return !isNaN(sh) && sh <= 2; }),
                            studentData.exam_scores.filter((s,i) => { const sh = parseFloat(studentData.study_hours[i % studentData.study_hours.length]?.x); return !isNaN(sh) && sh > 2 && sh <= 4; }),
                            studentData.exam_scores.filter((s,i) => { const sh = parseFloat(studentData.study_hours[i % studentData.study_hours.length]?.x); return !isNaN(sh) && sh > 4 && sh <= 6; }),
                            studentData.exam_scores.filter((s,i) => { const sh = parseFloat(studentData.study_hours[i % studentData.study_hours.length]?.x); return !isNaN(sh) && sh > 6; }),
                        ].map(arr => arr.length > 0 ? arr : [NaN]), // Ensure array is not empty for boxplot, pass NaN if no data
                        backgroundColor: 'rgba(13, 148, 136, 0.2)',
                        borderColor: 'rgba(13, 148, 136, 1)',
                        borderWidth: 1,
                        itemRadius: 2,
                        itemStyle: 'circle',
                        outlierColor: '#FF0000'
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { title: { display: true, text: 'Nota do Exame' } } } }
            });
        }

        function initLifestyleCharts() {
            const lifestyleSelect = document.getElementById('lifestyleFactorSelector');
            plotLifestyleFactor(lifestyleSelect.value); 
            lifestyleSelect.onchange = () => {
                plotLifestyleFactor(lifestyleSelect.value);
            };
        }
        
        function plotLifestyleFactor(factorKey) {
            destroyChart(lifestyleChart);
            const ctxLifestyle = document.getElementById('lifestyleFactorChart').getContext('2d');
            let chartType, data, labels, xLabel, yLabel = 'Nota do Exame';
            const chartDescriptionEl = document.getElementById('lifestyleChartDescription');

            switch(factorKey) {
                case 'sleep_hours':
                    chartType = 'scatter';
                    data = studentData.sleep_hours_data.map(d => ({x: parseFloat(d.x), y: parseFloat(d.y)}));
                    xLabel = 'Horas de Sono';
                    chartDescriptionEl.textContent = 'Gráfico de dispersão: Horas de Sono vs. Nota do Exame.';
                    break;
                case 'mental_health_rating':
                    chartType = 'scatter'; 
                    data = studentData.mental_health_data.map(d => ({x: parseInt(d.x), y: parseFloat(d.y)}));
                    xLabel = 'Saúde Mental (1-10)';
                    chartDescriptionEl.textContent = 'Gráfico de dispersão: Saúde Mental vs. Nota do Exame.';
                    break;
                case 'diet_quality':
                    chartType = 'boxplot';
                    labels = ['Ruim', 'Razoável', 'Boa'];
                    data = [
                        studentData.exam_scores.slice(0, 250).map(s => s - 5*Math.random()), 
                        studentData.exam_scores.slice(250, 700), 
                        studentData.exam_scores.slice(700, 1000).map(s => s + 5*Math.random()) 
                    ].map(arr => arr.length > 0 ? arr : [NaN]);
                    xLabel = 'Qualidade da Dieta';
                    chartDescriptionEl.textContent = 'Boxplot: Nota do Exame por Qualidade da Dieta.';
                    break;
                case 'parental_education_level':
                    chartType = 'boxplot';
                    labels = ['Fundamental', 'Médio', 'Superior Incompleto', 'Superior Completo', 'Pós-graduação', 'Desconhecido'];
                     data = [ 
                        studentData.exam_scores.slice(0,100).map(s => s - 10*Math.random()),
                        studentData.exam_scores.slice(100,300).map(s => s - 5*Math.random()),
                        studentData.exam_scores.slice(300,500),
                        studentData.exam_scores.slice(500,750).map(s => s + 5*Math.random()),
                        studentData.exam_scores.slice(750,900).map(s => s + 10*Math.random()),
                        studentData.exam_scores.slice(900,1000).map(s => s - 2*Math.random()) 
                    ].map(arr => arr.length > 0 ? arr : [NaN]);
                    xLabel = 'Nível Educacional dos Pais';
                    chartDescriptionEl.textContent = 'Boxplot: Nota do Exame por Nível Educacional dos Pais.';
                    break;
                case 'extracurricular_participation':
                    chartType = 'boxplot';
                    labels = ['Não', 'Sim'];
                     data = [
                        studentData.exam_scores.slice(0, 600).map(s => s - 2*Math.random()), 
                        studentData.exam_scores.slice(600, 1000).map(s => s + 2*Math.random()) 
                    ].map(arr => arr.length > 0 ? arr : [NaN]);
                    xLabel = 'Participação Extracurricular';
                    chartDescriptionEl.textContent = 'Boxplot: Nota do Exame por Participação Extracurricular.';
                    break;
                case 'part_time_job':
                    chartType = 'boxplot';
                    labels = ['Não', 'Sim'];
                     data = [
                        studentData.exam_scores.slice(0, 700).map(s => s + 3*Math.random()), 
                        studentData.exam_scores.slice(700, 1000).map(s => s - 3*Math.random()) 
                    ].map(arr => arr.length > 0 ? arr : [NaN]);
                    xLabel = 'Trabalho em Meio Período';
                    chartDescriptionEl.textContent = 'Boxplot: Nota do Exame por Trabalho em Meio Período.';
                    break;
                default: data = []; labels = []; xLabel = '';
            }

            let chartConfigLifestyle;
            if (chartType === 'scatter') {
                chartConfigLifestyle = {
                    type: 'scatter',
                    data: { datasets: [{ label: `${xLabel} vs. Nota`, data: data, backgroundColor: 'rgba(13, 148, 136, 0.6)' }] },
                    options: { responsive: true, maintainAspectRatio: false, scales: { x: { title: { display: true, text: xLabel }}, y: { title: { display: true, text: yLabel }}}}
                };
            } else { 
                chartConfigLifestyle = {
                    type: 'boxplot',
                    data: { labels: labels, datasets: [{ label: `Notas por ${xLabel}`, data: data, backgroundColor: 'rgba(13, 148, 136, 0.2)', borderColor: 'rgba(13, 148, 136, 1)', borderWidth: 1 }] },
                    options: { responsive: true, maintainAspectRatio: false, scales: { y: { title: { display: true, text: yLabel } } } }
                };
            }
            lifestyleChart = new Chart(ctxLifestyle, chartConfigLifestyle);
        }

        function initPredictiveCharts() {
            destroyChart(featureImportanceChart);
            const ctxFeatureImportance = document.getElementById('featureImportanceChart').getContext('2d');
            featureImportanceChart = new Chart(ctxFeatureImportance, {
                type: 'bar',
                data: {
                    labels: ['Horas de Estudo/Dia', 'Frequência Aulas (%)', 'Saúde Mental (1-10)', 'Horas de Sono', 'Qualidade da Internet', 'Nível Ed. Pais'],
                    datasets: [{
                        label: 'Importância da Feature (%)',
                        data: [35, 25, 15, 10, 8, 7], 
                        backgroundColor: [
                            'rgba(13, 148, 136, 0.7)', 
                            'rgba(13, 148, 136, 0.6)',
                            'rgba(13, 148, 136, 0.5)',
                            'rgba(13, 148, 136, 0.4)',
                            'rgba(13, 148, 136, 0.3)',
                            'rgba(13, 148, 136, 0.2)'
                        ],
                        borderColor: 'rgba(13, 148, 136, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y', 
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { x: { title: { display: true, text: 'Importância Relativa (%)' } } },
                    plugins: { legend: { display: false } }
                }
            });
        }

        // Initialize charts for the default active tab
        document.addEventListener('DOMContentLoaded', () => {
            // Manual registration of BoxPlot components
            // This needs to be done after Chart.js and the boxplot plugin script are loaded,
            // and before any boxplot chart is instantiated.
            // It's moved here to ensure scripts are loaded.
            if (typeof Chart !== 'undefined' && typeof ChartBoxPlot !== 'undefined') {
                Chart.register(
                    ChartBoxPlot.BoxPlotController,
                    ChartBoxPlot.BoxAndWhiskers,
                    ChartBoxPlot.BoxPlotScale
                );
            } else {
                console.error("Critical: Chart.js or BoxPlot plugin not loaded before registration attempt. Boxplot charts may fail.");
            }
            initOverviewCharts(); 
        });

    </script>
</body>
</html>
